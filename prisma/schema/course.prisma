enum audience_target {
  participant
  accelerator
}

enum module_category {
  article
  quiz
  assignment
}

enum submission_status {
  in_progress
  submitted
  graded
}

model courses_participants {
  id        String @id @default(uuid())
  course_id String
  user_id   String

  enrolled_at DateTime  @default(now())
  finished_at DateTime?

  course courses @relation(fields: [course_id], references: [id], onDelete: Cascade)

  @@unique([course_id, user_id])
}

model courses {
  id          String   @id @default(uuid())
  title       String
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  mentor_id String?

  mentor users? @relation(fields: [mentor_id], references: [id], onDelete: SetNull)

  classification  String?
  audience_target audience_target

  course_type course_type
  regional    String?

  is_published Boolean   @default(false)
  published_at DateTime?

  modules              course_modules[]
  courses_participants courses_participants[]

  @@map("courses")
}

enum course_type {
  mandatory
  elective
}

model course_module_completions {
  id        String @id @default(uuid())
  user_id   String
  module_id String

  marked_at DateTime @default(now())

  module course_modules @relation(fields: [module_id], references: [id])

  @@unique([user_id, module_id])
}

model course_modules {
  id        String @id @default(uuid())
  course_id String

  title       String
  description String?
  sequence    Int

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  course courses @relation(fields: [course_id], references: [id], onDelete: Cascade)

  items                     course_module_items[]
  course_module_completions course_module_completions[]
}

model course_module_item_completions {
  id      String @id @default(uuid())
  user_id String
  item_id String

  marked_at DateTime @default(now())

  item course_module_items @relation(fields: [item_id], references: [id])

  @@unique([user_id, item_id])
}

model course_module_items {
  id        String @id @default(uuid())
  module_id String

  title    String
  category module_category
  sequence Int

  data Json

  is_published Boolean @default(true)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  module course_modules @relation(fields: [module_id], references: [id], onDelete: Cascade)

  submissions                    course_item_submissions[]
  course_module_item_completions course_module_item_completions[]
}

model course_item_submissions {
  id String @id @default(uuid())

  user_id String
  item_id String

  score Float?

  response_snapshot Json @db.JsonB

  status submission_status @default(in_progress)

  feedback  String?
  graded_at DateTime?
  graded_by Json?     @db.JsonB

  submitted_at DateTime @default(now())
  updated_at   DateTime @updatedAt

  user users               @relation(fields: [user_id], references: [id], onDelete: Cascade)
  item course_module_items @relation(fields: [item_id], references: [id], onDelete: Cascade)

  @@unique([user_id, item_id])
}
